# Movie API

Простой REST API для управления коллекцией фильмов с поддержкой кириллицы и JSON в UTF-8.  
Позволяет добавлять, получать, удалять фильмы, а также получать недавно добавленные фильмы.

---

## Содержание

- [Описание проекта](#описание-проекта)  
- [Требования](#требования)  
- [Установка и запуск](#установка-и-запуск)  
- [API эндпоинты](#api-эндпоинты)  
- [Тестирование](#тестирование)  
- [Структура тестов и их назначение](#структура-тестов-и-их-назначение)  
- [Контакты](#контакты)  

---

## Описание проекта

API реализовано на Flask с поддержкой CORS и хранением данных в JSON-файле (`movies.json`).  
Поддерживается кириллица и UTF-8 в выводе JSON.  
Фильмы имеют поля: `id`, `title`, `director`, `year`, `genre`, `rating`, `created_at`.

---

## Требования

- Python 3.12.0  
- pip 23.2.1 (для установки зависимостей)  
- pyCharm Community Edition 2024.2.4
- Windows 11 (желательно) 

---

## Установка и запуск

1. Клонируйте репозиторий:
   ```bash
   > git clone https://github.com/hamsterofyoursdreams/examGabdrakhmanovSHA-02
   ```
   ```bash
   > cd examGabdrakhmanovSHA-02
   ```

2. Создайте и активируйте виртуальное окружение (рекомендуется):
   ```bash
   > python -m venv venv
   ```
   ```bash
   > source venv/bin/activate # Linux/macOS
   ```
   ```bash
   venv\Scripts\activate # Windows
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите API:
   ```bash
   python app.py
   ```
По умолчанию сервер будет доступен по адресу: `http://0.0.0.0:5000`

---

## API эндпоинты

### Получить все фильмы

- **URL:** `/movies`  
- **Метод:** `GET`
- **Ответ:** JSON-массив фильмов
- **Коды ответа:**  
- 200 — фильм найден

### Получить недавно добавленные фильмы (за последние 30 дней)

- **URL:** `/movies/recent`  
- **Метод:** `GET`
- **Ответ:** JSON-массив фильмов, добавленных за последние 30 дней
- **Коды ответа:**  
- 200 — фильм найден

### Получить фильм по ID

- **URL:** `/movies/<movie_id>`  
- **Метод:** `GET`  
- **Ответ:** JSON-объект фильма  
- **Коды ответа:**  
- 200 — фильм найден  
- 404 — фильм не найден  

### Добавить новый фильм

- **URL:** `/movies`  
- **Метод:** `POST`  
- **Тело запроса:** JSON с полями:  
- `title` (строка)  
- `director` (строка)  
- `year` (число, 1888 ≤ year ≤ текущий год + 2)  
- `genre` (строка)  
- `rating` (число, 0 ≤ rating ≤ 10)  
- **Ответ:** JSON-объект добавленного фильма с уникальным `id` и `created_at`  
- **Коды ответа:**  
- 201 — фильм успешно добавлен  
- 400 — некорректные данные или неверный формат JSON

### Удалить фильм по ID

- **URL:** `/movies/<movie_id>`  
- **Метод:** `DELETE`  
- **Ответ:** пустое тело  
- **Коды ответа:**  
- 204 — фильм успешно удалён  
- 404 — фильм не найден

---

## Тестирование

Для запуска тестов используется `pytest`.  
Установите pytest, если он не установлен (pytest прописан в requirements.txt):
   ```bash
    pip install pytest
   ```
Запуск тестов:
   ```bash
   pytest test_app.py -v
   ```
   ```bash
   pytest test_app.py
   ```
---

## Структура тестов и их назначение

### Фикстуры

- **`client`** — создает тестовый клиент Flask для имитации запросов к API.  
- **`setup_and_teardown`** — подготавливает временный JSON-файл с начальными данными и подменяет пути к файлам данных в приложении, чтобы тесты не влияли на реальные данные.

### Тесты функции `is_valid_movie_data`

- **`test_valid_movie_data`** — проверяет, что корректные данные фильма проходят валидацию.  
- **`test_invalid_movie_data`** — проверяет, что данные с некорректным годом и рейтингом не проходят валидацию.

### Тесты эндпоинта GET `/movies`

- **`test_get_all_movies`** — проверяет, что API возвращает все фильмы из базы.  
- **`test_get_all_movies_empty`** — проверяет, что при пустой базе возвращается пустой список.

### Тесты эндпоинта GET `/movies/recent`

- **`test_get_recent_movies`** — проверяет, что возвращаются фильмы, добавленные за последние 30 дней.  
- **`test_get_recent_movies_empty`** — проверяет, что фильмы со старой датой не попадают в результат.

### Тесты эндпоинта GET `/movies/<id>`

- **`test_get_movie_by_id`** — проверяет успешное получение фильма по ID.  
- **`test_get_nonexistent_movie`** — проверяет корректную ошибку при запросе несуществующего фильма.

### Тесты эндпоинта POST `/movies`

- **`test_add_movie`** — проверяет успешное добавление нового фильма с корректными данными.  
- **`test_add_invalid_movie`** — проверяет ошибку при добавлении фильма с некорректными данными.

### Тесты эндпоинта DELETE `/movies/<id>`

- **`test_delete_movie`** — проверяет успешное удаление фильма и отсутствие его после удаления.  
- **`test_delete_nonexistent_movie`** — проверяет ошибку при попытке удалить несуществующий фильм.

### Дополнительный тест с русскими данными

- **`test_full_russian_movie`** — проверяет добавление, получение и удаление фильма с полным русским описанием (поля на кириллице).

---

## Контакты

Если у вас возникли вопросы или предложения, свяжитесь со мной:  

- Email: askar.gabdraxmanov@mail.com  
- Telegram: [@hamsterofyoursdreams](https://t.me/username)  
